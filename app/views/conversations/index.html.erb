<%= render 'navbar' %>

<div class="list converation-list">
  <%= content_tag_for(:div, @conversations, class: 'list-item') do |conversation| %>

    <a class="conversation-heading" href="#">
      <div class="number">#<%= conversation.number %></div>
      <div class="participants">
        <% conversation.participants.each do |person| %>
          <%= avatar(person) %>
        <% end %>
      </div>
      <div class="preview">
        <%= preview conversation %>
      </div>
      <div class="updated">
        <%= distance_in_time_of_last_message conversation %>
      </div>
    </a>

    <div class="conversation-body">

      <!-- Previous conversation -->
      <div class="list message-list">
        <%= content_tag_for(:div, conversation.messages, class: ['message', 'list-item']) do |message| %>
          <div class="from"><%= avatar(message.person) %></div>
          <div class="created">
            posted <%= time_ago_in_words(message.created_at) %>
          </div>
          <div class="content"><%= message.content %></div>
        <% end %>
      </div>

      <!-- Reply -->
      <%= form_for(conversation.messages.new, html: {class: 'reply-form'}) do |f| %>
        <%= f.text_area :content %>
        <div class="form-actions">
          <%= f.submit 'Send & Archive' %>
        </div>
      <% end %>

    </div>

  <% end %>
</div>

<script>
  $('.conversation-heading').click(function(e) {
    var $target;
    e.preventDefault();
    $target = $(e.target);
    $conversation = $target.parents('.conversation');
    $conversation.find('.conversation-body').toggle();
  });
</script>
